<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0f0f0f" media="(prefers-color-scheme: dark)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Job Review">
<title>Job Review</title>
<style>
:root {
  --bg:               #0f0f0f;
  --surface:          #1a1a1a;
  --surface-hover:    #222;
  --surface2:         #222;
  --surface3:         #333;
  --border:           #2a2a2a;
  --text:             #e0e0e0;
  --text-dim:         #b0b0b0;
  --text-muted:       #888;
  --text-faint:       #555;
  --text-heading:     #fff;
  --scrollbar:        #333;

  --btn-applied-bg:         #052e16;
  --btn-applied-color:      #4ade80;
  --btn-applied-border:     #166534;
  --btn-applied-hover:      #0a3d1f;
  --btn-reject-bg:          #1c0a0a;
  --btn-reject-color:       #f87171;
  --btn-reject-border:      #7f1d1d;
  --btn-reject-hover:       #2a0f0f;

  --match-bg:         #052e16;
  --match-color:      #4ade80;

  --link-color:       #2563eb;
  --reject-focus:     #8b0000;
  --error-color:      #f87171;

  --copy-bg:          #222;
  --copy-bg-hover:    #333;
  --copy-color:       #888;
  --copy-color-hover: #ccc;
  --copy-copied:      #4ade80;

  --status-done:      #4ade80;
}

@media (prefers-color-scheme: light) {
  :root {
    --bg:               #f4f4f5;
    --surface:          #ffffff;
    --surface-hover:    #f9f9f9;
    --surface2:         #f0f0f0;
    --surface3:         #e4e4e7;
    --border:           #d4d4d8;
    --text:             #18181b;
    --text-dim:         #3f3f46;
    --text-muted:       #71717a;
    --text-faint:       #a1a1aa;
    --text-heading:     #18181b;
    --scrollbar:        #d4d4d8;

    --btn-applied-bg:         #dcfce7;
    --btn-applied-color:      #15803d;
    --btn-applied-border:     #86efac;
    --btn-applied-hover:      #bbf7d0;
    --btn-reject-bg:          #fee2e2;
    --btn-reject-color:       #b91c1c;
    --btn-reject-border:      #fca5a5;
    --btn-reject-hover:       #fecaca;

    --match-bg:         #dcfce7;
    --match-color:      #15803d;

    --link-color:       #2563eb;
    --reject-focus:     #b91c1c;
    --error-color:      #dc2626;

    --copy-bg:          #f0f0f0;
    --copy-bg-hover:    #e4e4e7;
    --copy-color:       #71717a;
    --copy-color-hover: #18181b;
    --copy-copied:      #15803d;

    --status-done:      #15803d;
  }
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}
.header {
  padding: 20px 20px 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.header-title {
  font-size: 22px;
  font-weight: 700;
  color: var(--text-heading);
}
.counter {
  font-size: 13px;
  color: var(--text-faint);
  font-variant-numeric: tabular-nums;
}
/* ── Job card ── */
.card {
  margin: 0 20px 12px;
  background: var(--surface);
  border-radius: 16px;
  padding: 16px;
  border: 1px solid var(--border);
}
@media (prefers-color-scheme: dark) {
  .card { border: none; }
}
.job-title {
  font-size: 17px;
  font-weight: 700;
  color: var(--text-heading);
  line-height: 1.3;
  margin-bottom: 4px;
}
.job-company {
  font-size: 14px;
  color: var(--text-muted);
  margin-bottom: 8px;
}
.job-url {
  font-size: 12px;
  color: var(--link-color);
  text-decoration: none;
  word-break: break-all;
  display: block;
  margin-bottom: 10px;
}
.job-url:hover { text-decoration: underline; }
.match-badge {
  display: inline-block;
  background: var(--match-bg);
  color: var(--match-color);
  font-size: 12px;
  font-weight: 600;
  padding: 3px 10px;
  border-radius: 20px;
}
/* ── Sections ── */
.section {
  margin: 0 20px 10px;
}
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}
.section-label {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.08em;
  color: var(--text-faint);
  text-transform: uppercase;
}
.copy-btn {
  font-size: 11px;
  font-weight: 600;
  color: var(--copy-color);
  background: var(--copy-bg);
  border: none;
  border-radius: 6px;
  padding: 3px 10px;
  cursor: pointer;
  transition: background 0.15s, color 0.15s;
}
.copy-btn:hover { background: var(--copy-bg-hover); color: var(--copy-color-hover); }
.copy-btn.copied { color: var(--copy-copied); }
.text-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  font-size: 13px;
  line-height: 1.6;
  color: var(--text-dim);
  max-height: 120px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
}
@media (prefers-color-scheme: dark) {
  .text-box { border: none; }
}
/* ── Rejection input ── */
.reject-section {
  margin: 0 20px 12px;
}
.reject-input {
  width: 100%;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  font-size: 14px;
  color: var(--text);
  font-family: inherit;
  outline: none;
  transition: border-color 0.2s;
}
.reject-input:focus { border-color: var(--reject-focus); }
.reject-input::placeholder { color: var(--text-faint); }
.reject-error {
  font-size: 12px;
  color: var(--error-color);
  margin-top: 5px;
  min-height: 18px;
  padding-left: 2px;
}
/* ── Action buttons ── */
.actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 4px 20px 24px;
  margin-top: auto;
}
.btn-action {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 14px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: opacity 0.2s, transform 0.1s;
  letter-spacing: 0.01em;
}
.btn-action:active { transform: scale(0.98); }
.btn-action:disabled { opacity: 0.3; cursor: not-allowed; transform: none; }
.btn-applied {
  background: var(--btn-applied-bg);
  color: var(--btn-applied-color);
  border: 1px solid var(--btn-applied-border);
}
.btn-applied:hover:not(:disabled) { background: var(--btn-applied-hover); }
.btn-reject {
  background: var(--btn-reject-bg);
  color: var(--btn-reject-color);
  border: 1px solid var(--btn-reject-border);
}
.btn-reject:hover:not(:disabled) { background: var(--btn-reject-hover); }
/* ── Empty / loading states ── */
.empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: var(--text-faint);
  gap: 12px;
  padding: 40px;
  text-align: center;
}
.empty-icon { font-size: 48px; }
.empty-text { font-size: 15px; }
.loading {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted);
  font-size: 14px;
}
/* ── Back link ── */
.back-link {
  font-size: 13px;
  color: var(--text-faint);
  text-decoration: none;
  padding: 0 20px 8px;
  display: inline-block;
}
.back-link:hover { color: var(--text-muted); }
/* ── Scrollbars ── */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 4px; }
</style>
</head>
<body>
<div class="header">
<span class="header-title">Review Jobs</span>
<span class="counter" id="counter"></span>
</div>
<a class="back-link" href="/">← Back</a>
<div id="app">
<div class="loading">Loading jobs…</div>
</div>
<script>
let jobs = [];
let index = 0;
async function fetchJobs() {
try {
const res = await fetch('/api/review/jobs');
if (!res.ok) throw new Error('Failed to fetch');
jobs = await res.json();
if (jobs.length === 0) {
showEmpty();
    } else {
renderJob(0);
    }
  } catch (e) {
document.getElementById('app').innerHTML =
`<div class="empty-state"><div class="empty-icon">⚠️</div><div class="empty-text">Could not load jobs.<br>${e.message}</div></div>`;
  }
}
function showEmpty() {
document.getElementById('counter').textContent = '';
document.getElementById('app').innerHTML =
`<div class="empty-state"><div class="empty-icon">✓</div><div class="empty-text">No unapplied matched jobs to review.</div></div>`;
}
function renderJob(i) {
const job = jobs[i];
document.getElementById('counter').textContent = `${i + 1} / ${jobs.length}`;
document.getElementById('app').innerHTML = `
    <div class="card">
      <div class="job-title" id="title"></div>
      <div class="job-company" id="company"></div>
      <a class="job-url" id="url" href="#" target="_blank" rel="noopener"></a>
      <span class="match-badge" id="match"></span>
    </div>
    <div class="section">
      <div class="section-header">
        <span class="section-label">About Me</span>
        <button class="copy-btn" onclick="copyText('about', this)">Copy</button>
      </div>
      <div class="text-box" id="about"></div>
    </div>
    <div class="section">
      <div class="section-header">
        <span class="section-label">Keywords</span>
        <button class="copy-btn" onclick="copyText('keywords', this)">Copy</button>
      </div>
      <div class="text-box" id="keywords"></div>
    </div>
    <div class="reject-section">
      <div class="section-header" style="margin-bottom:6px">
        <span class="section-label">Rejection Reason</span>
      </div>
      <input class="reject-input" id="reason" type="text" placeholder="Required when rejecting…">
      <div class="reject-error" id="reason-error"></div>
    </div>
    <div class="actions">
      <button class="btn-action btn-applied" onclick="onApplied()">Applied ✓</button>
      <button class="btn-action btn-reject" onclick="onReject()">Reject ✗</button>
    </div>
  `;
document.getElementById('title').textContent = job.title || '—';
document.getElementById('company').textContent = job.company || '—';
const urlEl = document.getElementById('url');
urlEl.textContent = job.url || '';
urlEl.href = job.url || '#';
document.getElementById('match').textContent =
`Skillset match: ${job.skillset_match_percent ?? 0}%`;
document.getElementById('about').textContent =
job.cv_about_me || '(no CV section)';
document.getElementById('keywords').textContent =
job.cv_keywords || '(no keywords)';
}
function advance() {
index++;
if (index >= jobs.length) {
showEmpty();
  } else {
renderJob(index);
  }
}
async function onApplied() {
const job = jobs[index];
setLoading(true);
try {
await fetch('/api/review/applied', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ url: job.url }),
    });
  } catch {}
advance();
}
async function onReject() {
const reason = document.getElementById('reason').value.trim();
if (!reason) {
document.getElementById('reason-error').textContent = 'Reason is required to reject.';
return;
  }
document.getElementById('reason-error').textContent = '';
const job = jobs[index];
setLoading(true);
try {
await fetch('/api/review/reject', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ url: job.url, reason }),
    });
  } catch {}
advance();
}
function setLoading(on) {
document.querySelectorAll('.btn-action').forEach(b => b.disabled = on);
}
function copyText(id, btn) {
const text = document.getElementById(id).textContent;
navigator.clipboard.writeText(text).then(() => {
btn.textContent = 'Copied!';
btn.classList.add('copied');
setTimeout(() => {
btn.textContent = 'Copy';
btn.classList.remove('copied');
    }, 1500);
  });
}
fetchJobs();
</script>
</body>
</html>